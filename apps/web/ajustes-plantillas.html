<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/src/style.css" />
    <title>Ajustes â€“ Plantillas</title>
    <style>
      /* Burbuja estilo WhatsApp para la vista previa */
      .chat-preview-wrapper {
        background: #e8f1eb; /* tono claro neutro */
        position: relative;
        overflow: hidden;
      }
      .chat-preview-bubble {
        position: relative;
        max-width: 85%;
        background: #dcf8c6; /* verde claro WhatsApp */
        color: #111827;
  border-radius: 12px;
  padding: 24px 44px 16px 12px; /* padding top mayor para nombre interno */
        font-size: 0.875rem;
        line-height: 1.25rem;
        box-shadow: 0 1px 1px rgba(0,0,0,0.08);
        word-break: break-word;
        white-space: pre-wrap;
        font-family: system-ui, sans-serif;
      }
      .chat-preview-bubble:after {
        content: "";
        position: absolute;
        right: -4px;
        bottom: 0;
        width: 12px;
        height: 16px;
        background: #dcf8c6;
        clip-path: path("M0,16 C6,12 9,8 12,0 L12,16 Z");
      }
      .chat-preview-time {
        position: absolute;
        right: 10px;
        bottom: 4px;
        font-size: 10px;
        line-height: 10px;
        color: #4b5563;
        user-select: none;
      }
      .chat-preview-area {
        position: relative;
        display: block; /* controlamos alineaciÃ³n dentro */
        padding: 18px 12px 28px;
        min-height: 160px;
        background-image:
          radial-gradient(circle at 2px 2px, rgba(0,0,0,0.04) 1px, transparent 0),
          radial-gradient(circle at 22px 12px, rgba(0,0,0,0.04) 1px, transparent 0);
        background-size: 24px 24px;
      }
      .chat-bubble-stack {
        position: relative;
        width: 100%;
        display: flex;
        flex-direction: column;
        align-items: flex-end; /* fuerza burbuja a la derecha absoluta */
      }
      .chat-preview-bubble { align-self: flex-end; }
      /* Si se quisiera invertir (lado izquierdo) bastarÃ­a cambiar align-items a flex-start */
      .chat-preview-sender {
        position: absolute;
        top: 6px;
        left: 12px;
        font-size: 11px;
        font-weight: 600;
        color: #1d4ed8; /* azul como nombre en grupo */
        letter-spacing: .2px;
        user-select: none;
        pointer-events: none;
        white-space: nowrap;
      }
      @media (prefers-color-scheme: dark) {
        .chat-preview-wrapper { background:#0f172a; }
        .chat-preview-area { background-color:#0f172a; }
        .chat-preview-bubble { background:#056162; color:#f1f5f9; }
        .chat-preview-bubble:after { background:#056162; }
        .chat-preview-time { color:#cbd5e1; }
        .chat-preview-sender { color:#60a5fa; }
      }
    </style>
  </head>
  <body class="bg-gray-50 text-slate-800">
    <div id="app" class="min-h-screen flex">
      <div class="flex-1 main-wrapper lg:ml-64">
        <header class="sticky top-0 z-30 bg-white border-b border-slate-200">
          <div class="flex items-center gap-2 p-4">
            <button id="sidebarOpen" class="lg:hidden p-2 rounded hover:bg-slate-100" aria-label="Abrir menÃº">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg>
            </button>
            <h1 class="text-lg font-semibold">Ajustes / Plantillas</h1>
          </div>
        </header>
        <main class="p-6 space-y-6">
          <div class="flex flex-col lg:flex-row gap-6">
            <!-- Lista de plantillas -->
            <aside class="w-full lg:w-56 shrink-0">
              <div class="rounded-lg border border-slate-200 bg-white p-4">
                <h2 class="text-xs font-semibold text-slate-600 tracking-wide mb-3 uppercase">Plantillas</h2>
                <ul id="tpl-list" class="space-y-1 text-sm"></ul>
                <div class="mt-4 border-t pt-3">
                  <p class="text-[10px] text-slate-400 leading-snug">Se guardan automÃ¡ticamente. MÃ¡s tipos podrÃ¡n aÃ±adirse aquÃ­.</p>
                </div>
              </div>
            </aside>
            <!-- Editor -->
            <section class="flex-1 rounded-lg border border-slate-200 bg-white p-5 space-y-5 min-h-[480px]" id="tpl-editor" data-empty="true">
              <div class="flex items-start justify-between gap-4 flex-wrap">
                <div>
                  <h2 id="tpl-editor-title" class="text-sm font-semibold tracking-wide text-slate-700 mb-1">Selecciona una plantilla</h2>
                  <p id="tpl-editor-desc" class="text-[11px] text-slate-500 leading-snug max-w-prose">Elige una plantilla a la izquierda para editar su contenido.</p>
                </div>
                <div class="flex items-center gap-2">
                  <button id="tpl-reset" type="button" class="hidden text-[11px] px-2 py-1 rounded border border-slate-300 hover:bg-slate-100">Restablecer</button>
                  <button id="tpl-save" class="hidden px-3 py-1.5 rounded-md bg-slate-900 text-white text-xs hover:bg-slate-800 disabled:opacity-40">Guardar</button>
                </div>
              </div>
              <div id="tpl-editor-body" class="grid gap-6 md:grid-cols-2 opacity-60 pointer-events-none">
                <div class="space-y-3">
                  <label for="tpl-text" class="block text-xs font-medium text-slate-600">Contenido</label>
                  <div class="relative">
                    <textarea id="tpl-text" rows="10" class="w-full rounded-md border border-slate-300 pr-10 pl-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-400 font-mono resize-y" placeholder="Selecciona una plantilla"></textarea>
                    <button type="button" id="tpl-emoji-btn" class="absolute top-2 right-2 w-8 h-8 flex items-center justify-center rounded hover:bg-slate-100 text-lg" title="Emojis">ðŸ˜Š</button>
                  </div>
                  <div class="flex flex-wrap gap-2 text-[10px]" id="tpl-vars"></div>
                  <div class="pt-1 flex items-center gap-2">
                    <span id="tpl-status" class="text-[11px] text-slate-500"></span>
                  </div>
                </div>
                <div class="space-y-3">
                  <h3 class="text-xs font-semibold text-slate-600">Vista previa</h3>
                  <div class="rounded-md border border-slate-200 chat-preview-wrapper">
                    <div class="chat-preview-area">
                      <div class="chat-bubble-stack">
                        <div class="chat-preview-bubble" id="tpl-preview">
                          <span class="chat-preview-sender" id="tpl-preview-sender">{{Nombre de la empresa (provisional)}}</span>
                          Ejemplo de mensaje...
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="mt-4 space-y-2">
                    <h3 class="text-xs font-semibold text-slate-600">Ejemplo de evento</h3>
                    <div class="rounded border border-slate-200 bg-white p-3 text-[11px] leading-relaxed font-mono whitespace-pre-wrap space-y-1" id="tpl-event-example">
  <div class="text-slate-700"><span class="text-amber-600">TÃ­tulo:</span> <span data-eg-var="titulo">@archimago.fat - Mariposas en el brazo</span></div>
  <div class="text-slate-700"><span class="text-amber-600">Cliente:</span> <span data-eg-var="nombre">Juan Manuel</span> <span data-eg-var="apellidos">Garrido Aguilera</span> (<span data-eg-var="instagram">@archimago.fat</span>) Â· <span data-eg-var="movil">628836603</span></div>
  <div class="text-slate-700"><span class="text-amber-600">Horario:</span> <span data-eg-var="fecha">05/08/2025</span> Â· <span data-eg-var="hora_inicio">12:00</span> - <span data-eg-var="hora_fin">15:00</span> (<span data-eg-var="duracion">3 horas</span>)</div>
  <div class="text-slate-700"><span class="text-amber-600">Importe:</span> <span data-eg-var="precio_total">100</span> â‚¬ Â· Pagado: <span data-eg-var="precio_pagado">20</span> â‚¬ Â· Pendiente: <span data-eg-var="precio_pendiente">80</span> â‚¬</div>
                    </div>
                    <p class="text-[10px] text-slate-400">Este bloque es ilustrativo; aÃ±ade o adapta variables soportadas en la lista superior.</p>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </main>
      </div>
    </div>
    <script type="module" src="/src/layout/inject-sidebar.js"></script>
    <script type="module" src="/src/main.js"></script>
    <script type="module" src="/src/user-menu.js"></script>
    <script type="module" src="/src/ajustes-plantillas.js"></script>
  </body>
</html>
