<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/src/style.css" />
    <title>Ajustes – Calendario</title>
  </head>
  <body class="bg-gray-50 text-slate-800">
    <div id="app" class="min-h-screen flex">
      <div class="flex-1 main-wrapper lg:ml-64">
        <header class="sticky top-0 z-30 bg-white border-b border-slate-200">
          <div class="flex items-center gap-2 p-4">
            <button id="sidebarOpen" class="lg:hidden p-2 rounded hover:bg-slate-100" aria-label="Abrir menú">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg>
            </button>
            <h1 class="text-lg font-semibold">Ajustes / Calendario</h1>
          </div>
        </header>
        <main class="p-6 space-y-8 max-w-3xl mx-auto">
          <!-- Google Calendar primero -->
          <section class="rounded-xl border border-slate-200 bg-white/90 backdrop-blur-sm p-6 shadow-sm" id="google-cal-integration">
            <header class="flex items-center gap-3 flex-wrap">
              <h2 class="text-sm font-semibold tracking-wide text-slate-700 uppercase">Google Calendar</h2>
              <span id="google-cal-status" class="text-xs font-normal px-2 py-1 rounded bg-slate-100 text-slate-600 hidden"></span>
            </header>
            <div class="mt-4 flex flex-wrap items-center gap-2" id="google-cal-controls">
              <div id="google-cal-picker" class="hidden relative order-1">
                <button id="google-cal-picker-btn" type="button" class="text-xs px-2 py-1 rounded border border-slate-300 text-slate-700 hover:bg-slate-100 flex items-center gap-1" title="Seleccionar calendario">
                  <span id="google-cal-current">primary</span>
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M6 9l6 6 6-6"/></svg>
                </button>
                <div id="google-cal-dropdown" class="hidden absolute z-40 mt-1 w-52 max-h-64 overflow-auto bg-white border border-slate-200 rounded shadow-sm text-xs"></div>
              </div>
              <button id="google-cal-disconnect" type="button" class="hidden text-xs px-2 py-1 rounded border border-red-300 text-red-700 hover:bg-red-50 order-2">Desconectar</button>
              <button id="google-cal-connect" type="button" class="hidden text-xs px-2 py-1 rounded border border-indigo-300 text-indigo-700 hover:bg-indigo-50 order-3">Conectar Google</button>
              <button id="google-cal-reauth-inline" type="button" class="hidden text-xs px-2 py-1 rounded border border-indigo-300 text-indigo-700 hover:bg-indigo-50 order-4">Reautorizar</button>
            </div>
            <!-- Modal confirmación desconexión -->
            <div id="google-disconnect-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4" role="dialog" aria-modal="true" aria-labelledby="gdisc-title">
              <div class="bg-white rounded-md shadow-lg max-w-md w-full p-5 space-y-4">
                <h3 id="gdisc-title" class="text-sm font-semibold">Desconectar Google Calendar</h3>
                <p class="text-xs text-slate-600 leading-relaxed">Esta acción eliminará <strong>todos los eventos locales</strong> de la aplicación. Los eventos seguirán existiendo en tu Google Calendar. Para confirmar, escribe <code class="px-1 py-0.5 bg-slate-100 rounded text-[11px]">DESCONECTAR</code> y pulsa Desconectar definitivamente.</p>
                <input id="google-disconnect-confirm" type="text" class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-red-400" placeholder="Escribe DESCONECTAR" autocomplete="off" />
                <div class="flex justify-end gap-2 pt-2">
                  <button type="button" id="google-disconnect-cancel" class="px-3 py-1.5 text-xs rounded border border-slate-300 hover:bg-slate-100">Cancelar</button>
                  <button type="button" id="google-disconnect-confirm-btn" class="px-3 py-1.5 text-xs rounded bg-red-600 text-white disabled:opacity-40" disabled>Desconectar definitivamente</button>
                </div>
              </div>
            </div>
          </section>
          <!-- Configuración visual Extra Checks -->
          <section class="rounded-xl border border-slate-200 bg-white/90 backdrop-blur-sm p-6 shadow-sm" id="extra-checks-config">
            <header class="mb-4">
              <h2 class="text-sm font-semibold tracking-wide text-slate-700 uppercase">Indicadores extra</h2>
              <p class="mt-1 text-[11px] text-slate-500 leading-snug">Configura la visibilidad y estilo de los 3 indicadores booleanos para eventos.</p>
            </header>
            <div class="space-y-6" id="extra-checks-root"></div>
          </section>
          <!-- Festivos después -->
          <section class="rounded-xl border border-slate-200 bg-white/90 backdrop-blur-sm p-6 shadow-sm" id="calendar-settings-root">
            <h2 class="text-sm font-semibold tracking-wide text-slate-700 uppercase mb-4">Festivos de la comunidad autónoma</h2>
            <form class="grid gap-3 max-w-md" id="calendar-ccaa-form">
              <label class="text-xs font-medium text-slate-600" for="ccaa">Selecciona tu comunidad</label>
              <select id="ccaa" name="ccaa" class="w-full rounded-md border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-400 bg-white">
                <option value="ES-AN">Andalucía</option>
                <option value="ES-AR">Aragón</option>
                <option value="ES-AS">Principado de Asturias</option>
                <option value="ES-IB">Illes Balears</option>
                <option value="ES-CN">Canarias</option>
                <option value="ES-CB">Cantabria</option>
                <option value="ES-CM">Castilla-La Mancha</option>
                <option value="ES-CL">Castilla y León</option>
                <option value="ES-CT">Cataluña</option>
                <option value="ES-VC">Comunitat Valenciana</option>
                <option value="ES-EX">Extremadura</option>
                <option value="ES-GA">Galicia</option>
                <option value="ES-MD">Comunidad de Madrid</option>
                <option value="ES-MC">Región de Murcia</option>
                <option value="ES-NC">Comunidad Foral de Navarra</option>
                <option value="ES-PV">País Vasco</option>
                <option value="ES-RI">La Rioja</option>
                <option value="ES-CE">Ceuta</option>
                <option value="ES-ML">Melilla</option>
              </select>
              <div class="pt-2">
                <button type="submit" class="inline-flex items-center gap-2 rounded-md bg-slate-900 text-white px-4 py-2 text-sm hover:bg-slate-800">Guardar</button>
              </div>
            </form>
          </section>
        </main>
      </div>
    </div>
    <script type="module" src="/src/layout/inject-sidebar.js"></script>
    <script type="module" src="/src/main.js"></script>
    <script type="module" src="/src/user-menu.js"></script>
    <script type="module" src="/src/google-calendar-ui.js"></script>
    <script type="module" src="/src/ajustes-calendario.js"></script>
  </body>
</html>
