<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/src/style.css" />
    <title>Ajustes – General</title>
  </head>
  <body class="bg-gray-50 text-slate-800">
    <div id="app" class="min-h-screen flex">
      <div class="flex-1 main-wrapper lg:ml-64">
        <header class="sticky top-0 z-30 bg-white border-b border-slate-200">
          <div class="flex items-center gap-2 p-4">
            <button id="sidebarOpen" class="lg:hidden p-2 rounded hover:bg-slate-100" aria-label="Abrir menú">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" class="size-5"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"/></svg>
            </button>
            <h1 class="text-lg font-semibold">Ajustes / General</h1>
          </div>
        </header>
        <main class="p-6 space-y-6">
          <section class="rounded-lg border border-slate-200 bg-white p-5 space-y-5">
            <div>
              <h2 class="text-sm font-semibold tracking-wide text-slate-700 uppercase mb-3">Consentimientos informados</h2>
              <div class="flex items-start gap-3">
                <input id="inp-business-consent" type="checkbox" class="mt-0.5 h-4 w-4 rounded border-slate-300 text-slate-900 focus:ring-slate-400" />
                <label for="inp-business-consent" class="text-sm leading-relaxed select-none">
                  Gestionar consentimientos informados a través de la web, integrado con Whatsapp.
                </label>
              </div>
            </div>
            <div id="consent-config" class="hidden space-y-4 border-t pt-4">
              <div>
                <label class="block text-xs font-semibold text-slate-600 mb-1">Plantilla PDF</label>
                <div class="flex items-center gap-3 flex-wrap">
                  <input id="pdf-file" type="file" accept="application/pdf" class="text-xs" />
                  <button id="btn-upload" type="button" class="px-3 py-1.5 rounded-md bg-slate-700 text-white text-xs hover:bg-slate-600 disabled:opacity-40">Subir</button>
                  <a id="pdf-download" href="#" target="_blank" class="hidden text-xs text-slate-600 underline">Ver PDF actual</a>
                  <span id="pdf-status" class="text-[11px] text-slate-500"></span>
                </div>
              </div>
              <div>
                <label class="block text-xs font-semibold text-slate-600 mb-2">Mapeo de campos (clic para colocar)</label>
                <div class="grid gap-4 lg:grid-cols-4 mb-8">
                  <div class="lg:col-span-3 border rounded-md overflow-auto max-h-[800px] bg-slate-100 relative min-w-0" id="pdf-preview">
                    <canvas id="pdf-canvas" class="max-w-full h-auto"></canvas>
                    <div id="field-layer" class="absolute inset-0"></div>
                  </div>
                  <div class="lg:col-span-1 space-y-3 max-h-[800px]" id="right-panel">
                    <div class="sticky top-0 z-10 bg-white pt-1 pb-0.5">
                      <div class="relative text-xs select-none">
                        <div class="flex">
                          <button type="button" data-tab="variables" class="tab-btn flex-1 text-center px-2 py-1 font-medium text-slate-900">Variables</button>
                          <button type="button" data-tab="fijos" class="tab-btn flex-1 text-center px-2 py-1 text-slate-600 hover:text-slate-800">Fijos</button>
                          <button type="button" data-tab="firma" class="tab-btn flex-1 text-center px-2 py-1 text-slate-600 hover:text-slate-800">Firma</button>
                        </div>
                        <div id="tab-indicator" class="absolute bottom-0 h-0.5 bg-slate-700 rounded transition-all duration-300 ease-out opacity-0"></div>
                      </div>
                    </div>
                    <div id="tab-variables" class="space-y-3 pt-0 overflow-y-auto pr-1 max-h-[600px]">
                    <div class="text-xs text-slate-500 leading-snug space-y-1">
                      <p>Selecciona un campo y haz clic para un punto o click o arrastra para definir un rectángulo.</p>
                      <p>Ajusta el tamaño de letra global o individual.</p>
                      <p>Puedes arrastrar los marcadores ya colocados para reposicionarlos.</p>
                    </div>
                    <div class="flex flex-wrap items-center gap-2 text-xs">
                      <label for="toggle-guides" class="shrink-0">Guías</label>
                      <input id="toggle-guides" type="checkbox" class="h-4 w-4 rounded border-slate-300" />
                      <span class="text-[10px] text-slate-500">(Snap líneas)</span>
                      <span class="inline-block w-px h-4 bg-slate-300 ml-1 mr-1"></span>
                      <label for="global-font-size" class="shrink-0">Tamaño global</label>
                      <select id="global-font-size" class="border rounded px-1 py-0.5 bg-white">
                        <option>8</option><option>9</option><option>10</option><option>11</option><option>12</option><option>13</option><option>14</option><option>15</option><option>16</option><option>18</option><option selected>20</option><option>22</option><option>24</option>
                      </select>
                      <button id="btn-apply-global-font" type="button" class="px-2 py-0.5 rounded bg-slate-700 text-white hover:bg-slate-600">Aplicar</button>
                    </div>
                    <select id="field-select" class="w-full border rounded px-2 py-1 text-xs">
                      <option value="">-- Campo --</option>
                      <option value="full_name">Nombre completo</option>
                      <option value="first_name">Nombre (separado)</option>
                      <option value="last_name">Apellidos (separado)</option>
                      <option value="dni">DNI</option>
                      <option value="legal_guardian_full_name">Nombre completo tutor legal</option>
                      <option value="legal_guardian_dni">DNI tutor legal</option>
                      <option value="address">Dirección</option>
                      <option value="postal_code">Código Postal</option>
                      <option value="birth_date">Fecha Nacimiento (completa)</option>
                      <option value="birth_date_day">Fecha de nacimiento (día)</option>
                      <option value="birth_date_month">Fecha de nacimiento (mes)</option>
                      <option value="birth_date_year">Fecha de nacimiento (año)</option>
                      <option value="mobile">Móvil</option>
                      <option value="appointment_day">Día cita</option>
                      <option value="appointment_month">Mes cita</option>
                      <option value="appointment_month_name">Mes cita (nombre)</option>
                      <option value="appointment_year_short">Año cita (2 últimos digitos)</option>
                      <option value="appointment_year">Año cita (4 dígitos)</option>
                    </select>
                    <ul id="field-list" class="space-y-1 text-xs"></ul>
                    <span id="map-status" class="block text-[11px] text-slate-500">(Autoguardado)</span>
                    </div>
                    <div id="tab-fijos" class="hidden space-y-3 text-xs pt-4 overflow-y-auto pr-1 max-h-[600px]">
                      <div>
                        <button id="btn-show-fixed-editor" type="button" class="w-full mb-2 px-2 py-1 rounded border border-slate-400 text-slate-700 hover:bg-slate-100 font-medium">Crear texto fijo</button>
                        <div id="fixed-editor" class="hidden border rounded p-2 space-y-2 bg-slate-50">
                          <div class="flex items-center gap-2">
                            <input id="fixed-text" type="text" placeholder="Texto fijo" class="flex-1 border rounded px-2 py-1 text-xs bg-white" />
                            <div class="flex items-center gap-1">
                              <label for="fixed-font" class="text-[10px] text-slate-600">Tamaño</label>
                              <select id="fixed-font" class="border rounded px-1 py-0.5 text-[11px] bg-white">
                                <option>8</option><option>9</option><option>10</option><option>11</option><option selected>12</option><option>13</option><option>14</option><option>16</option><option>18</option><option>20</option><option>22</option><option>24</option>
                              </select>
                            </div>
                          </div>
                          <div class="flex justify-end gap-2">
                            <button id="btn-cancel-fixed" type="button" class="px-2 py-0.5 rounded text-slate-600 hover:bg-slate-200">Cancelar</button>
                            <button id="btn-add-fixed" type="button" class="px-3 py-0.5 rounded bg-slate-700 text-white hover:bg-slate-600">Guardar</button>
                          </div>
                        </div>
                        <p class="mt-2 text-[10px] text-slate-500">Selecciona un fijo para posicionar o arrastrar; guardado aparte.</p>
                      </div>
                      <ul id="fixed-list" class="space-y-1 pt-1 border-t border-slate-200"></ul>
                      <div class="pt-1">
                        <span id="fixed-status" class="block text-[11px] text-slate-500 mt-1">(Autoguardado)</span>
                      </div>
                    </div>
                    <div id="tab-firma" class="hidden space-y-3 text-xs pt-4 overflow-y-auto pr-1 max-h-[600px]">
                      <div class="space-y-2">
                        <p class="text-[11px] text-slate-600 leading-snug">Captura una única firma manuscrita que se insertará en el PDF.</p>
                        <div class="space-y-2" id="signature-preview-wrapper">
                          <div id="signature-preview" class="border border-slate-300 rounded p-2 flex items-center justify-center min-h-[90px] text-[10px] text-slate-400 select-none" style="background-color:#fff;background-image:linear-gradient(45deg,#d1d5db 25%,transparent 25%,transparent 75%,#d1d5db 75%,#d1d5db),linear-gradient(45deg,#d1d5db 25%,transparent 25%,transparent 75%,#d1d5db 75%,#d1d5db);background-position:0 0,10px 10px;background-size:20px 20px;">Sin firma</div>
                          <div class="flex gap-2">
                            <button id="btn-create-signature" type="button" class="flex-1 px-2 py-1 rounded bg-slate-700 text-white hover:bg-slate-600">Crear / Editar firma</button>
                            <button id="btn-remove-signature" type="button" class="px-2 py-1 rounded bg-red-600/80 text-white hover:bg-red-600 text-[11px] hidden">Eliminar</button>
                          </div>
                          <div class="flex gap-2">
                            <button id="btn-place-signature" type="button" class="flex-1 px-2 py-1 rounded border border-slate-400 text-slate-700 hover:bg-slate-100 disabled:opacity-40">Posicionar firma</button>
                          </div>
                          <span id="signature-status" class="block text-[10px] text-slate-500"></span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="pt-2">
              <button id="btn-save-general" type="button" class="inline-flex items-center gap-2 rounded-md bg-slate-900 text-white px-4 py-2 text-sm hover:bg-slate-800">
                <span>Guardar</span>
              </button>
              <span id="save-status" class="ml-3 text-[11px] text-slate-500"></span>
            </div>
          </section>
        </main>
      </div>
    </div>
    <script type="module" src="/src/layout/inject-sidebar.js"></script>
    <script type="module" src="/src/main.js"></script>
    <script type="module" src="/src/user-menu.js"></script>
    <script type="module" src="/src/ajustes-general.js"></script>
  </body>
</html>
